<script type="text/babel">
    const { useState, useEffect } = React;
    
    const SUPABASE_URL = "https://lsctlfavvxasbkcvbjmq.supabase.co";
    const SUPABASE_KEY = "sb_publishable_33maxbMOQrHvDSYwFouYNQ_EWrP1s8K";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Edit 3: Added "Others" to cuisines
    const cuisines = ["Italian", "Mexican", "Asian", "American", "Indian", "Mediterranean", "Health Food", "Others"];

    const App = () => {
        // Edit 2: Initializing with empty/null values so they aren't "on" by default
        const [meals, setMeals] = useState({
            Breakfast: { cuisine: '', where: '', healthy: null, quantity: null },
            Lunch: { cuisine: '', where: '', healthy: null, quantity: null },
            Dinner: { cuisine: '', where: '', healthy: null, quantity: null },
        });

        const [activity, setActivity] = useState({
            cardio: 'None',
            tennis: false,
            intensity: 'M',
            rehab: false,
            stretch: false
        });

        const updateMeal = (meal, field, value) => {
            setMeals(prev => ({ 
                ...prev, 
                [meal]: { ...prev[meal], [field]: value } 
            }));
        };

        const handleSubmit = async () => {
            const { error } = await supabaseClient.from('daily_logs').insert([{
                meal_data: meals,
                cardio_type: activity.cardio,
                tennis: activity.tennis,
                intensity: activity.intensity,
                rehab: activity.rehab,
                stretch: activity.stretch,
                created_at: new Date().toISOString()
            }]);
            
            if (error) alert("Error: " + error.message);
            else alert("âœ… Data logged successfully!");
        };

        const SectionHeader = ({ title }) => (
            <h2 className="text-[13px] font-semibold text-[#6E6E73] uppercase tracking-wider ml-4 mb-2 mt-6">
                {title}
            </h2>
        );

        const MealCard = ({ name }) => (
            // Edit 1: Added overflow-hidden and fixed structure to prevent layout jumps
            <div className="bg-white rounded-[14px] mx-4 mb-4 divide-y divide-gray-100 overflow-hidden shadow-sm">
                <div className="p-4 flex justify-between items-center h-[56px]">
                    <span className="font-semibold text-lg">{name}</span>
                    <select 
                        className="text-[#007AFF] bg-transparent outline-none text-right max-w-[150px]"
                        value={meals[name].cuisine}
                        onChange={(e) => updateMeal(name, 'cuisine', e.target.value)}
                    >
                        <option value="" disabled>Select Cuisine</option>
                        {cuisines.map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                </div>
                
                <div className="p-4 flex justify-between items-center h-[56px]">
                    <span className="text-gray-700">Location</span>
                    <div className="bg-[#EEEEF0] p-1 rounded-lg flex gap-1">
                        {['Home', 'Out'].map(opt => (
                            <button key={opt}
                                onClick={() => updateMeal(name, 'where', opt)}
                                className={`px-4 py-1 rounded-md text-sm transition-all ${meals[name].where === opt ? 'bg-white shadow-sm font-medium' : 'text-gray-500'}`}
                            >{opt}</button>
                        ))}
                    </div>
                </div>

                <div className="p-4 flex justify-between items-center h-[56px]">
                    <span className="text-gray-700">Healthy Choice</span>
                    <input 
                        type="checkbox" 
                        checked={meals[name].healthy === 'Y'} 
                        onChange={(e) => updateMeal(name, 'healthy', e.target.checked ? 'Y' : 'N')} 
                    />
                </div>

                <div className="p-4 flex justify-between items-center h-[56px]">
                    <span className="text-gray-700">Portion Controlled</span>
                    <input 
                        type="checkbox" 
                        checked={meals[name].quantity === 'Controlled'} 
                        onChange={(e) => updateMeal(name, 'quantity', e.target.checked ? 'Controlled' : 'Not')} 
                    />
                </div>
            </div>
        );

        return (
            <div className="max-w-md mx-auto min-h-screen pb-12 safe-top">
                <div className="pt-8 px-5 pb-4">
                    <h1 className="text-3xl font-bold tracking-tight">Daily Habit Tracker</h1>
                    <p className="text-[#6E6E73]">{new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                </div>

                <SectionHeader title="Meals" />
                <MealCard name="Breakfast" />
                <MealCard name="Lunch" />
                <MealCard name="Dinner" />

                <SectionHeader title="Activity" />
                <div className="bg-white rounded-[14px] mx-4 divide-y divide-gray-100 shadow-sm">
                    <div className="p-4 flex justify-between items-center h-[56px]">
                        <span>Cardio</span>
                        <select value={activity.cardio} onChange={(e) => setActivity({...activity, cardio: e.target.value})} className="text-[#007AFF] bg-transparent">
                            <option>None</option><option>Cycle</option><option>Swim</option><option>Run</option>
                        </select>
                    </div>
                    <div className="p-4 flex justify-between items-center h-[56px]">
                        <span>Tennis</span>
                        <input type="checkbox" checked={activity.tennis} onChange={(e) => setActivity({...activity, tennis: e.target.checked})} />
                    </div>
                    <div className="p-4 flex justify-between items-center h-[56px]">
                        <span>Intensity</span>
                        <div className="bg-[#EEEEF0] p-1 rounded-lg flex gap-1">
                            {['L', 'M', 'H'].map(l => (
                                <button key={l} onClick={() => setActivity({...activity, intensity: l})}
                                    className={`px-4 py-1 rounded-md text-sm transition-all ${activity.intensity === l ? 'bg-white shadow-sm' : 'text-gray-500'}`}
                                >{l}</button>
                            ))}
                        </div>
                    </div>
                    <div className="p-4 flex justify-between items-center h-[56px]">
                        <span>Rehab Exercises</span>
                        <input type="checkbox" checked={activity.rehab} onChange={(e) => setActivity({...activity, rehab: e.target.checked})} />
                    </div>
                    <div className="p-4 flex justify-between items-center h-[56px]">
                        <span>Stretch</span>
                        <input type="checkbox" checked={activity.stretch} onChange={(e) => setActivity({...activity, stretch: e.target.checked})} />
                    </div>
                </div>

                <div className="p-4 mt-6">
                    <button 
                        onClick={handleSubmit}
                        className="w-full bg-[#007AFF] text-white font-semibold py-4 rounded-2xl active:scale-[0.98] transition-all"
                    >
                        Complete Day
                    </button>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
